<!DOCTYPE html>
<html lang="python">
<head>
<meta charset="utf-8"/>
<title>Applied Machine Learning</title>
<meta name="author" content="(Robert Utterback)"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/reveal.js/3.0.0/css/reveal.css"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/reveal.js/3.0.0/css/theme/white.css" id="theme"/>

<link rel="stylesheet" href="./notes.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/reveal.js/3.0.0/lib/css/zenburn.css"/>
<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'https://cdn.jsdelivr.net/reveal.js/3.0.0/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div class="reveal">
<div class="slides">
\(
\renewcommand{\vec}[1]{\boldsymbol{#1}}
\newcommand{\E}{\mathop{\boldsymbol{E}}}
\newcommand{\var}{\boldsymbol{Var}}
\newcommand{\norm}[1]{\lvert\lvert#1\rvert\rvert}
\newcommand{\abs}[1]{\lvert#1\rvert}
\newcommand{\ltwo}[1]{\norm{#1}_2}
\newcommand{\lone}[1]{\norm{#1}_1}
\newcommand{\sgn}[1]{\text{sign}\left( #1 \right)}
\newcommand{\e}{\mathrm{e}}
\newcommand{\minw}{\min_{w \in \mathbb{R}^p}}
\newcommand{\sumn}{\sum_{i=1}^n}
\newcommand{\logloss}{\log{(\exp{(-y_iw^T\vec{x}_i)} + 1)}}
\)

<section>
<section id="slide-orgb10d5f4">
<h2 id="orgb10d5f4">Feature Engineering</h2>
<p>
Robert Utterback
</p>

<p>
Based on slides by Andreas Muller
</p>
<aside class="notes">
<p>
Today we’ll talk about preprocessing and featureengineering. What
we’re talking about today mostly applies to linear models, and not to
tree-based models, but it also applies to neural nets and kernel SVMs.
</p>

<p>
\(2+2\)
</p>

</aside>
</section>
</section>
<section>
<section id="slide-org7a0b3bb">
<h2 id="org7a0b3bb">Count-Based Encoding</h2>
<div class="outline-text-2" id="text-org7a0b3bb">
</div>
</section>
<section id="slide-orga13d38c">
<h3 id="orga13d38c">Count-Based Encoding</h3>
<ul>
<li>For high cardinality categorical features</li>
<li>Example: US states, given low samples</li>
<li>Instead of 50 one-hot variables, one “response encoded” variable.</li>
<li>For regression:
<ul>
<li>"people in this state have an average response of y”</li>

</ul></li>
<li>Binary classification: – “people in this state have likelihood p for class 1”</li>
<li>Multiclass: – One feature per class: probability distribution</li>

</ul>
<aside class="notes">
<p>
Too many columns to use one-hot encoding.
For each level of the categorical variable, want to find the mean response and use that as the feature value.
</p>

<p>
Nothing ready-made in sklearn for this.
</p>

</aside>
</section>
<section id="slide-org496ff23">
<h3 id="org496ff23">Example: Adult census, native-country</h3>
<div class="org-src-container">

<pre><code class="python" >data = pd.read_csv("adult.csv")
data.columns
</code></pre>
</div>

<pre class="example">
Index(['age', 'workclass', 'education', 'education-num', 'marital-status',
'occupation', 'relationship', 'race', 'gender', 'capital-gain', 'capital-loss',
'hours-per-week', 'native-country', 'income'], dtype='object')
</pre>

<pre class="example">
 United-States                 29170
 Mexico                          643
 ?                               583
 Philippines                     198
 Germany                         137
 Canada                          121
 Puerto-Rico                     114
 El-Salvador                     106
 India                           100
 Cuba                             95
 England                          90
 Jamaica                          81
</pre>

<aside class="notes">
<p>
Lots of data about people working in the US and their income.
So here's the data&#x2026;
</p>

</aside>
</section>
<section id="slide-org9bebcf1">
<h3 id="org9bebcf1"></h3>
<div class="column" style="float:left; width: 50%">
<pre class="example">
                             &lt;=50K      &gt;50K
 ?                           0.749571  0.250429
 Cambodia                    0.631579  0.368421
 Canada                      0.677686  0.322314
 China                       0.733333  0.266667
 Columbia                    0.966102  0.033898
 Cuba                        0.736842  0.263158
 Dominican-Republic          0.971429  0.028571
 Ecuador                     0.857143  0.142857
 El-Salvador                 0.915094  0.084906
 England                     0.666667  0.333333
 France                      0.586207  0.413793
 Germany                     0.678832  0.321168
 Greece                      0.724138  0.275862
 Guatemala                   0.953125  0.046875
 Haiti                       0.909091  0.090909
 Holand-Netherlands          1.000000  0.000000
 Honduras                    0.923077  0.076923
 Hong                        0.700000  0.300000
 Hungary                     0.769231  0.230769
 India                       0.600000  0.400000
 Iran                        0.581395  0.418605
 Ireland                     0.791667  0.208333
 Italy                       0.657534  0.342466
 Jamaica                     0.876543  0.123457
 Japan                       0.612903  0.387097
 Laos                        0.888889  0.111111
 Mexico                      0.948678  0.051322
 Nicaragua                   0.941176  0.058824
 Outlying-US(Guam-USVI-etc)  1.000000  0.000000
 Peru                        0.935484  0.064516
 Philippines                 0.691919  0.308081
 Poland                      0.800000  0.200000
 Portugal                    0.891892  0.108108
 Puerto-Rico                 0.894737  0.105263
 Scotland                    0.750000  0.250000
 South                       0.800000  0.200000
 Taiwan                      0.607843  0.392157
 Thailand                    0.833333  0.166667
 Trinadad&amp;Tobago             0.894737  0.105263
 United-States               0.754165  0.245835
 Vietnam                     0.925373  0.074627
 Yugoslavia                  0.625000  0.375000
</pre>
</div>
<div class="column" style="float:left; width: 50%">

</div>
<aside class="notes">
<p>
Instead of 50 new features, I do this.  For each country, look at &lt;=
50K and &gt;50K.  Note that income is the target variable; actually
predicting middle class or not. 
</p>

</aside>
</section>
<section id="slide-org7fdfbc5">
<h3 id="org7fdfbc5"></h3>
<div class="column" style="float:left; width: 50%">
<font size=6>
<pre class="example">
                             &lt;=50K      &gt;50K
 ?                           0.749571  0.250429
 Cambodia                    0.631579  0.368421
 Canada                      0.677686  0.322314
 China                       0.733333  0.266667
 Columbia                    0.966102  0.033898
 Cuba                        0.736842  0.263158
 Dominican-Republic          0.971429  0.028571
 Ecuador                     0.857143  0.142857
 El-Salvador                 0.915094  0.084906
 England                     0.666667  0.333333
 France                      0.586207  0.413793
 Germany                     0.678832  0.321168
 Greece                      0.724138  0.275862
 Guatemala                   0.953125  0.046875
 Haiti                       0.909091  0.090909
 Holand-Netherlands          1.000000  0.000000
 Honduras                    0.923077  0.076923
 Hong                        0.700000  0.300000
 Hungary                     0.769231  0.230769
 India                       0.600000  0.400000
 Iran                        0.581395  0.418605
 Ireland                     0.791667  0.208333
 Italy                       0.657534  0.342466
 Jamaica                     0.876543  0.123457
 Japan                       0.612903  0.387097
 Laos                        0.888889  0.111111
 Mexico                      0.948678  0.051322
 Nicaragua                   0.941176  0.058824
 Outlying-US(Guam-USVI-etc)  1.000000  0.000000
 Peru                        0.935484  0.064516
 Philippines                 0.691919  0.308081
 Poland                      0.800000  0.200000
 Portugal                    0.891892  0.108108
 Puerto-Rico                 0.894737  0.105263
 Scotland                    0.750000  0.250000
 South                       0.800000  0.200000
 Taiwan                      0.607843  0.392157
 Thailand                    0.833333  0.166667
 Trinadad&amp;Tobago             0.894737  0.105263
 United-States               0.754165  0.245835
 Vietnam                     0.925373  0.074627
 Yugoslavia                  0.625000  0.375000
</pre>
</font>
</div>
<div class="column" style="float:left; width: 50%">
<font size=6>
<pre class="example">
        frequency               native-country  income
        0.245835                United-States   &lt;=50K
        0.245835                United-States   &lt;=50K
        0.245835                United-States   &lt;=50K
        0.245835                United-States   &lt;=50K
        0.263158                         Cuba   &lt;=50K
        0.245835                United-States   &lt;=50K
        0.123457                      Jamaica   &lt;=50K
        0.245835                United-States    &gt;50K
        0.245835                United-States    &gt;50K
        0.245835                United-States    &gt;50K
        0.245835                United-States    &gt;50K
        0.400000                        India    &gt;50K
        0.245835                United-States   &lt;=50K
        0.245835                United-States   &lt;=50K
        0.250429                            ?    &gt;50K
        0.051322                       Mexico   &lt;=50K
        0.245835                United-States   &lt;=50K
        0.245835                United-States   &lt;=50K
        0.245835                United-States   &lt;=50K
        0.245835                United-States    &gt;50K
        0.245835                United-States    &gt;50K
        0.245835                United-States   &lt;=50K
        0.245835                United-States   &lt;=50K
        0.245835                United-States   &lt;=50K
        0.245835                United-States   &lt;=50K
        0.245835                United-States    &gt;50K
        0.245835                United-States   &lt;=50K
        0.200000                        South    &gt;50K
        0.245835                United-States   &lt;=50K
        0.245835                United-States   &lt;=50K
        0.245835                United-States   &lt;=50K
        0.245835                United-States   &lt;=50K
        0.245835                United-States   &lt;=50K
        0.245835                United-States   &lt;=50K
        0.245835                United-States   &lt;=50K
</pre>
</font>
</div>
<aside class="notes">
<p>
Then for each datapoint, you just add the frequency of that
county. And hopefully this encodes the information of the country.  So
we would drop the country column &#x2014; we're replacing a discrete
feature with continuous one.
</p>

<p>
So basically we're applying a simple algorithm to produce a new
feature designed to be "close" to the country&#x2026;feature engineering&#x2026;
</p>

</aside>
</section>
</section>
<section>
<section id="slide-org1689bdd">
<h2 id="org1689bdd">Feature Engineering</h2>
<div class="outline-text-2" id="text-org1689bdd">
</div>
</section>
<section id="slide-org583ab34">
<h3 id="org583ab34">Interaction Features</h3>

<div class="figure">
<p><img src="./assets/img_33.png" alt="img_33.png" height="500px" />
</p>
</div>
<aside class="notes">
<p>
2D data set, two classes. Not linearly separable&#x2026;
</p>

</aside>
</section>
<section id="slide-orga376f89">
<h3 id="orga376f89">Interaction Features</h3>

<div class="figure">
<p><img src="./assets/img_34.png" alt="img_34.png" height="400px" />
</p>
</div>


<div class="figure">
<p><img src="./assets/img_35.png" alt="img_35.png" />
</p>
</div>
<aside class="notes">
<p>
Can't do this with a linear model&#x2026;
</p>

</aside>
</section>
<section id="slide-orgf93fd1b">
<h3 id="orgf93fd1b"></h3>

<div class="figure">
<p><img src="./assets/img_36.png" alt="img_36.png" />
</p>
</div>


<div class="figure">
<p><img src="./assets/img_37.png" alt="img_37.png" />
</p>
</div>
<aside class="notes">
<p>
What if we add the interaction between the two features?
Now in 3 dimensions this can be separated with a linear model: a plane!
</p>

<p>
TODO: make this an actual 3D, interactive plot so students can see
where the plane would go.
</p>

</aside>
</section>
<section id="slide-org215c4cf">
<h3 id="org215c4cf"></h3>

<div class="figure">
<p><img src="./assets/img_38.png" alt="img_38.png" height="400px" />
</p>
</div>

<div class="org-src-container">

<pre><code class="python" >X_i_train, X_i_test, y_train, y_test = train_test_split(
    X_interaction, y, random_state=0)
logreg3 = LogisticRegressionCV().fit(X_i_train, y_train)
logreg3.score(X_i_test, y_test)
</code></pre>
</div>

<pre class="example">
0.960
</pre>
<aside class="notes">
<p>
So here is the data projected down to 2 dimensions. Logistic
regression in this case.
Great for continuous features.
</p>

</aside>
</section>
<section id="slide-orge666b9c">
<h3 id="orge666b9c"></h3>

<div class="figure">
<p><img src="./assets/img_40.png" alt="img_40.png" height="300px" />
</p>
</div>

<ul>
<li>One model per gender!</li>
<li>Keep original: common model + model for each gender to adjust.</li>
<li>Product of multiple categoricals: common model + multiple models to adjust for combinations</li>

</ul>
<aside class="notes">
<p>
For discrete features it does something a little different.
BY doing interaction features with gender, what I get is a model per gender!
i.e. learning two separate models, one for each gender.
</p>

<p>
Alternative: use original features, then use the interactions. So you have the original, then you have model for each gender saying how each one differs from the general model.
</p>

</aside>
</section>
<section id="slide-org6e70690">
<h3 id="org6e70690">More Interactions</h3>
<pre class="example">
age articles_bought gender spend$ time_online
 + Male * (age articles_bought spend$ time_online )
 + Female * (age articles_bought spend$ time_online )
 + (age &gt; 20) * (age articles_bought gender spend$ time_online)
 + (age &lt;= 20) * (age articles_bought gender spend$ time_online)
 + (age &lt;= 20) * Male * (age articles_bought gender spend$ time_online)
</pre>
<aside class="notes">
<p>
Lots of different interactions, can add lots of models. Adjust for a subpopulation.
</p>

</aside>
</section>
<section id="slide-org6aa0a62">
<h3 id="org6aa0a62">Polynomial Features</h3>

<div class="figure">
<p><img src="./assets/img_41.png" alt="img_41.png" height="550px" />
</p>
</div>
<aside class="notes">
<p>
This model is kind of linear, but also not really at the edges&#x2026;
</p>

</aside>
</section>
<section id="slide-orgf39dd5d">
<h3 id="orgf39dd5d">Polynomial Features</h3>

<div class="figure">
<p><img src="./assets/img_42.png" alt="img_42.png" height="550px" />
</p>
</div>
<aside class="notes">
<p>
We can add polynomial interactions between features and then we can actually model this! Kind of weird, right?
</p>

<p>
interactions_only = False by default, it will add powers of a single feature
order is how many features together, e.g. 3 is all products of 3
</p>

</aside>
</section>
<section id="slide-org5be4828">
<h3 id="org5be4828">Polynomial Features</h3>
<ul>
<li><code>PolynomialFeatures()</code> adds polynomials and interactions.</li>
<li>Transformer interface like scalers etc.</li>
<li>Create polynomial algorithms with <code>make_pipeline</code>!</li>

</ul>
</section>
<section id="slide-org61d0827">
<h3 id="org61d0827">Polynomial Features</h3>
<div class="org-src-container">

<pre><code class="python" >from sklearn.preprocessing import PolynomialFeatures
poly = PolynomialFeatures()
X_bc_poly = poly.fit_transform(X_bc_scaled)
print(X_bc_scaled.shape)
print(X_bc_poly.shape)
</code></pre>
</div>

<pre class="example">
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "/var/folders/sk/2t5zp0ns04zc6f37q_5h6bx40000gn/T/babel-3Zm3ac/python-eBYpTg", line 3, in &lt;module&gt;
    X_bc_poly = poly.fit_transform(X_bc_scaled)
NameError: name 'X_bc_scaled' is not defined

</pre>

<div class="org-src-container">

<pre><code class="python" >scores = cross_val_score(RidgeCV(), X_bc_scaled, y_train, cv=10)
print2(np.mean(scores), np.std(scores))
</code></pre>
</div>

<pre class="example">
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "/var/folders/sk/2t5zp0ns04zc6f37q_5h6bx40000gn/T/babel-3Zm3ac/python-VGRqjl", line 1, in &lt;module&gt;
    scores = cross_val_score(RidgeCV(), X_bc_scaled, y_train, cv=10)
NameError: name 'X_bc_scaled' is not defined

</pre>

<div class="org-src-container">

<pre><code class="python" >scores = cross_val_score(RidgeCV(), X_bc_poly, y_train, cv=10)
print2(np.mean(scores), np.std(scores))
</code></pre>
</div>

<pre class="example">
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "/var/folders/sk/2t5zp0ns04zc6f37q_5h6bx40000gn/T/babel-3Zm3ac/python-oTf8Qr", line 1, in &lt;module&gt;
    scores = cross_val_score(RidgeCV(), X_bc_poly, y_train, cv=10)
NameError: name 'X_bc_poly' is not defined

</pre>
</section>
<section id="slide-orgd016260">
<h3 id="orgd016260">Discretization and Binning</h3>
<ul>
<li>Loses data.</li>
<li>Target-independent might be bad</li>
<li>Powerful combined with interactions to create new features!</li>

</ul>
</section>
</section>
</div>
</div>
<script src="https://cdn.jsdelivr.net/reveal.js/3.0.0/lib/js/head.min.js"></script>
<script src="https://cdn.jsdelivr.net/reveal.js/3.0.0/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c/t',
rollingLinks: false,
keyboard: true,
overview: true,
margin: 0.05,
minScale: 0.20,
maxScale: 15.00,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: '0.0',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'https://cdn.jsdelivr.net/reveal.js/3.0.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: 'https://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
 { src: 'https://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'https://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]
,pdfSeparateFragments: false});
</script>
</body>
</html>
